<!DOCTYPE html>
<html lang="en">

<head>
    <!-- jQuery file -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- reset css file -->
    <link rel="stylesheet" href="assets/css/reset.css">
    <!-- bootstrap link -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
    <!-- css style file -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="assets/css/style.css">
    <title>survey</title>
</head>

<body>

    <div class="container justify-content-center">
        <h1>Please answer the question below!</h1>
        <div class="jumbotron col-8 center">
            <form class="col-8">
                <div class="form-group">
                    <h2>NAME</h2>
                    <input type="text" id="name-input" class="form-control">
                    <h2>Photo</h2>
                    <input id="photo-input" class="form-control" type="text" placeholder="URL only please">
                </div>
                <div>
                    <div id="first-question-div" class="form-group">
                        <p>1. how hot you like your pizza?</p>
                        <select name="" class="questions form-control" id="first-question">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>
                    <div id="second-question-div" class="form-group">
                        <p>2. how many slices can you eat?</p>
                        <select name="" class="questions form-control" id="second-question">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>

                    <div id="third-question-div" class="form-group">
                        <p>3. how often do you eat pizza?</p>
                        <select name="" class="questions form-control" id="third-question">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>

                    <div id="fourth-question-div" class="form-group">
                        <p>4. how often do you share your pizza?</p>
                        <select name="" class="questions form-control" id="fourth-question">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>

                    <div id="fifth-question-div" class="form-group">
                        <p>5. Do you like veggie pizza?</p>
                        <select name="" class="questions form-control" id="fifth-question">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>

                </div>

                <button id="submit-data" class="btn btn-primary" data-target="#my-modal"
                    data-toggle="modal">Submit</button>
                <button id="post-it" class="btn btn-success">Save it</button>
            </form>
        </div>
    </div>

    <div class="modal fade" id="my-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header" id="my-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="modal-photo">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal"
                        onclick="reload()">Close</button>
                </div>
            </div>
        </div>
    </div>
</body>

<script>


    var friend = []
    var r;
    var x;
    var totals = []
    var minValue;

    function myFriend() {
        $.ajax({
            url: "/api/friendList",
            method: "GET"
        })
            .then(function (results) {

                console.log(results);
                for (i = 0; i < results.length; i++) {

                    a = friend.answers;
                    b = results[i].answers;

                    var x = a.map(function (item, index) {
                        if (item > b[index]) {
                            var y = item;
                        }
                        else {
                            y = b[index];
                        }
                        if (b[index] < item) {
                            var z = b[index];
                        }
                        else {
                            z = item;
                        }
                        return y - z;

                    })
                    //to push the results to each user in API and current friend
                    console.log("this is " + x);
                    var score1 = results[i].score;
                    score1.push(x);
                    friend.score.push(x);


                    console.log("this is the test" + friend.answers);


                    function scoreSum2() {
                        var matchScore1 = results[i].score[0];
                        function getSum(total, num) {
                            return total + num;
                        }
                        var scoreSumValue2 = matchScore1.reduce(getSum);
                        r = results[i].number;
                        r.push(scoreSumValue2);
                        totals.push(scoreSumValue2);

                        console.log("this is number from API" + scoreSumValue2);

                    }
                    scoreSum2();
                    console.log("this is the total array : " + totals);
                    //var total2 = parseInt(totals);
                    minValue = Math.min(...totals);


                    console.log(results);
                    console.log("this is number from api loop  " + results[i].number);
                    var myMatch = results.filter(function (myMatch) {
                        return myMatch.number == minValue;
                    })
                    $("#my-header").empty();
                    $("#modal-photo").empty();
                    var myName = $("<h2>");
                    myName.text(myMatch[0].name);
                    $("#my-header").append(myName);
                    console.log(myMatch[0].photo);

                    $("#modal-photo").append("<img src=' " + myMatch[0].photo + "'/>")

                }



            })


    }

    //to post user in API
    $("#submit-data").on("click", function (event) {

        event.preventDefault();
        var value1 = $("#first-question").val().trim();
        var value2 = $("#second-question").val().trim();
        var value3 = $("#third-question").val().trim();
        var value4 = $("#fourth-question").val().trim();
        var value5 = $("#fifth-question").val().trim();
        friend = {
            name: $("#name-input").val().trim(),
            photo: $("#photo-input").val().trim(),
            answers: [Number(value1), Number(value2), Number(value3), Number(value4), Number(value5)],
            score: [],
            number: []
        }
        myFriend();
        getTotalScore1();
    })
    $("#post-it").on("click", function (event) {
        event.preventDefault();
        var value1 = $("#first-question").val().trim();
        var value2 = $("#second-question").val().trim();
        var value3 = $("#third-question").val().trim();
        var value4 = $("#fourth-question").val().trim();
        var value5 = $("#fifth-question").val().trim();
        var newValue = {
            name: $("#name-input").val().trim(),
            photo: $("#photo-input").val().trim(),
            answers: [Number(value1), Number(value2), Number(value3), Number(value4), Number(value5)],
            score: [],
            number: []
        }

        $.post("/api/friendList", newValue,
            function () {
                $("#name-input").val("");
                $("#photo-input").val("");
                $("#first-question").val("");
                $("#second-question").val("");
                $("#third-question").val("");
                $("#fourth-question").val("");
                $("#fifth-question").val("");
            }
        )
        //console.log("this is the smallest number : " + minValue);

    })
    function notNullTest() {
        
          var  valueName = $("#name-input").val();
           var valuePhoto = $("#photo-input").val();
           var value1 = $("#first-question").val();
           var value2 = $("#second-question").val();
           var value3 = $("#third-question").val();
           var value4 = $("#fourth-question").val();
            var value5 = $("#fifth-question").val();

    
        if (valueName || valuePhoto || value1 || value2 || value3 || value4 || value5 == null) {
            alert("please fill all the entries!");
            reload();
        }

    }

    //function to sum values in  friend array
    function getTotalScore1() {
        var myScore = friend.answers;
        function getSum(total, num) {
            return total + num;
        }
        var scoreSumValue = myScore.reduce(getSum);
        console.log(scoreSumValue);

    }

    function reload() {
        location.reload();
    }
</script>

</html>